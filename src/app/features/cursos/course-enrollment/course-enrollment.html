<div class="min-h-screen bg-gray-50 dark:bg-dark-bg py-12">
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-dark-text mb-2">
        Proceso de Matr√≠cula
      </h1>
      <p class="text-gray-600 dark:text-gray-400">
        @if (currentStep === 0) {
        Inicia sesi√≥n o crea una cuenta para matricularte en el curso
        } @else {
        Completa los siguientes pasos para matricularte en el curso
        }
      </p>
    </div>

    <!-- Progress Steps -->
    <div class="mb-12">
      <div class="flex items-center justify-between">
        @for (step of steps; track step.id) {
        <div class="flex flex-col items-center flex-1">
          <div class="flex items-center w-full">
            @if (step.id > 0) {
            <div class="flex-1 h-1 transition-colors duration-300"
              [class.bg-blue-600]="currentStep >= step.id"
              [class.bg-gray-300]="currentStep < step.id"
              [class.dark:bg-blue-500]="currentStep >= step.id"
              [class.dark:bg-gray-600]="currentStep < step.id">
            </div>
            }
            <div class="relative flex items-center justify-center">
              <div class="w-12 h-12 rounded-full border-2 flex items-center justify-center font-semibold transition-all duration-300"
                [class.bg-blue-600]="currentStep >= step.id"
                [class.border-blue-600]="currentStep >= step.id"
                [class.text-white]="currentStep >= step.id"
                [class.bg-white]="currentStep < step.id"
                [class.border-gray-300]="currentStep < step.id"
                [class.text-gray-400]="currentStep < step.id"
                [class.dark:bg-blue-500]="currentStep >= step.id"
                [class.dark:border-blue-500]="currentStep >= step.id"
                [class.dark:bg-dark-card]="currentStep < step.id"
                [class.dark:border-gray-600]="currentStep < step.id">
                @if (currentStep > step.id) {
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                } @else {
                <span>{{ step.id + 1 }}</span>
                }
              </div>
            </div>
            @if (step.id < steps.length - 1) {
            <div class="flex-1 h-1 transition-colors duration-300"
              [class.bg-blue-600]="currentStep > step.id"
              [class.bg-gray-300]="currentStep <= step.id"
              [class.dark:bg-blue-500]="currentStep > step.id"
              [class.dark:bg-gray-600]="currentStep <= step.id">
            </div>
            }
          </div>
          <div class="mt-3 text-center">
            <p class="text-sm font-medium transition-colors duration-300"
              [class.text-blue-600]="currentStep >= step.id"
              [class.text-gray-500]="currentStep < step.id"
              [class.dark:text-blue-400]="currentStep >= step.id"
              [class.dark:text-gray-500]="currentStep < step.id">
              {{ step.title }}
            </p>
            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">{{ step.description }}</p>
          </div>
        </div>
        }
      </div>
    </div>

    <!-- Error Message -->
    @if (errorMessage) {
    <div class="mb-6 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-4 animate-fadeIn">
      <div class="flex">
        <svg class="w-5 h-5 text-red-600 dark:text-red-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <p class="text-sm text-red-600 dark:text-red-400">{{ errorMessage }}</p>
      </div>
    </div>
    }

    <!-- Success Message -->
    @if (successMessage) {
    <div class="mb-6 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 p-4 animate-fadeIn">
      <div class="flex">
        <svg class="w-5 h-5 text-green-600 dark:text-green-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <p class="text-sm text-green-600 dark:text-green-400">{{ successMessage }}</p>
      </div>
    </div>
    }

    <!-- Step Content -->
    <div class="bg-white dark:bg-dark-card rounded-lg shadow-lg p-8 mb-8">
      
      <!-- Step 0: Login / Registro -->
      @if (currentStep === 0) {
      <div class="space-y-6">
        <!-- Course Preview -->
        @if (curso) {
        <div class="border border-blue-200 dark:border-blue-800 rounded-lg overflow-hidden bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 mb-6">
          <div class="flex items-center p-4">
            <img [src]="curso.imagen" [alt]="curso.titulo" class="w-20 h-20 rounded-lg object-cover flex-shrink-0">
            <div class="ml-4 flex-1">
              <h3 class="font-bold text-lg text-gray-900 dark:text-dark-text">{{ curso.titulo }}</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">{{ curso.instructor.nombre }} ‚Ä¢ {{ curso.duracion }}</p>
            </div>
            <div class="text-right">
              <p class="text-xs text-gray-500 dark:text-gray-400">Modalidad</p>
              <p class="font-semibold text-gray-900 dark:text-dark-text">{{ curso.modalidad }}</p>
            </div>
          </div>
        </div>
        }

        <!-- Tabs de Login / Registro -->
        <div class="border-b border-gray-200 dark:border-dark-border">
          <div class="flex space-x-4">
            <button (click)="showLoginForm = true" type="button"
              class="pb-4 px-6 font-semibold text-sm border-b-2 transition-colors"
              [class.border-blue-600]="showLoginForm"
              [class.text-blue-600]="showLoginForm"
              [class.dark:border-blue-500]="showLoginForm"
              [class.dark:text-blue-400]="showLoginForm"
              [class.border-transparent]="!showLoginForm"
              [class.text-gray-500]="!showLoginForm"
              [class.dark:text-gray-400]="!showLoginForm">
              <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
              </svg>
              Iniciar Sesi√≥n
            </button>
            <button (click)="showLoginForm = false" type="button"
              class="pb-4 px-6 font-semibold text-sm border-b-2 transition-colors"
              [class.border-blue-600]="!showLoginForm"
              [class.text-blue-600]="!showLoginForm"
              [class.dark:border-blue-500]="!showLoginForm"
              [class.dark:text-blue-400]="!showLoginForm"
              [class.border-transparent]="showLoginForm"
              [class.text-gray-500]="showLoginForm"
              [class.dark:text-gray-400]="showLoginForm">
              <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
              </svg>
              Crear Cuenta
            </button>
          </div>
        </div>

        <!-- Formulario de Login -->
        @if (showLoginForm) {
        <div class="pt-6 animate-fadeIn">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-dark-text mb-6">Inicia Sesi√≥n</h2>
          <form [formGroup]="loginForm" (ngSubmit)="processLogin()" class="space-y-6">
            <div>
              <label for="loginEmail" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Correo Electr√≥nico <span class="text-red-500">*</span>
              </label>
              <input type="email" id="loginEmail" formControlName="email"
                class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                placeholder="tu@correo.com">
              @if (loginEmail?.invalid && loginEmail?.touched) {
              <p class="mt-1 text-sm text-red-600 dark:text-red-400">Por favor ingresa un correo v√°lido</p>
              }
            </div>

            <div>
              <label for="loginPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Contrase√±a <span class="text-red-500">*</span>
              </label>
              <input type="password" id="loginPassword" formControlName="password"
                class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                placeholder="Tu contrase√±a">
              @if (loginPassword?.invalid && loginPassword?.touched) {
              <p class="mt-1 text-sm text-red-600 dark:text-red-400">Por favor ingresa tu contrase√±a</p>
              }
            </div>

            <button type="submit" [disabled]="isAuthenticating"
              class="w-full px-8 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center text-lg">
              @if (isAuthenticating) {
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Verificando...
              } @else {
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
              </svg>
              Iniciar Sesi√≥n
              }
            </button>

            <div class="text-center">
              <p class="text-sm text-gray-600 dark:text-gray-400">
                ¬øNo tienes cuenta? 
                <button type="button" (click)="toggleAuthForm()" class="text-blue-600 dark:text-blue-400 font-semibold hover:underline ml-1">
                  Cr√©ala aqu√≠
                </button>
              </p>
            </div>
          </form>
        </div>
        }

        <!-- Formulario de Registro -->
        @if (!showLoginForm) {
        <div class="pt-6 animate-fadeIn">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-dark-text mb-6">Crea tu Cuenta</h2>
          <form [formGroup]="registerForm" (ngSubmit)="processRegister()" class="space-y-6">
            <!-- Nombres -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <label for="nombres" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Nombres <span class="text-red-500">*</span>
                </label>
                <input type="text" id="nombres" formControlName="nombres"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                  placeholder="Juan Carlos">
                @if (nombres?.invalid && nombres?.touched) {
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">Requerido (m√≠n. 2 caracteres)</p>
                }
              </div>

              <div>
                <label for="apellidoPaterno" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Apellido Paterno <span class="text-red-500">*</span>
                </label>
                <input type="text" id="apellidoPaterno" formControlName="apellidoPaterno"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                  placeholder="P√©rez">
                @if (apellidoPaterno?.invalid && apellidoPaterno?.touched) {
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">Requerido</p>
                }
              </div>

              <div>
                <label for="apellidoMaterno" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Apellido Materno <span class="text-red-500">*</span>
                </label>
                <input type="text" id="apellidoMaterno" formControlName="apellidoMaterno"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                  placeholder="Garc√≠a">
                @if (apellidoMaterno?.invalid && apellidoMaterno?.touched) {
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">Requerido</p>
                }
              </div>
            </div>

            <!-- Email y Password -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="correoElectronico" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Correo Electr√≥nico <span class="text-red-500">*</span>
                </label>
                <input type="email" id="correoElectronico" formControlName="correoElectronico"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                  placeholder="tu@correo.com">
                @if (correoElectronico?.invalid && correoElectronico?.touched) {
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">Ingresa un correo v√°lido</p>
                }
              </div>

              <div>
                <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Contrase√±a <span class="text-gray-400">(Opcional)</span>
                </label>
                <input type="password" id="password" formControlName="password"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                  placeholder="Dejar vac√≠o para generar autom√°ticamente">
                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Se generar√° una segura si est√° vac√≠o</p>
              </div>
            </div>

            <!-- Documento y Tel√©fono -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="documento" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Documento de Identidad <span class="text-red-500">*</span>
                </label>
                <input type="text" id="documento" formControlName="documento"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                  placeholder="12345678">
                @if (documento?.invalid && documento?.touched) {
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">M√≠nimo 8 caracteres</p>
                }
              </div>

              <div>
                <label for="telefono" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Tel√©fono <span class="text-red-500">*</span>
                </label>
                <input type="tel" id="telefono" formControlName="telefono"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                  placeholder="987654321">
                @if (telefono?.invalid && telefono?.touched) {
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">Solo n√∫meros (9-15 d√≠gitos)</p>
                }
              </div>
            </div>

            <!-- Fecha de Nacimiento -->
            <div>
              <label for="fechaNacimiento" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Fecha de Nacimiento <span class="text-red-500">*</span>
              </label>
              <input type="date" id="fechaNacimiento" formControlName="fechaNacimiento"
                class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors">
              @if (fechaNacimiento?.invalid && fechaNacimiento?.touched) {
              <p class="mt-1 text-sm text-red-600 dark:text-red-400">Por favor ingresa tu fecha de nacimiento</p>
              }
            </div>

            <!-- Direcci√≥n -->
            <div>
              <label for="direccion" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Direcci√≥n <span class="text-red-500">*</span>
              </label>
              <input type="text" id="direccion" formControlName="direccion"
                class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                placeholder="Av. Principal 123, Distrito">
              @if (direccion?.invalid && direccion?.touched) {
              <p class="mt-1 text-sm text-red-600 dark:text-red-400">M√≠nimo 10 caracteres</p>
              }
            </div>

            <!-- Ciudad y C√≥digo Postal -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="ciudad" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  Ciudad <span class="text-red-500">*</span>
                </label>
                <input type="text" id="ciudad" formControlName="ciudad"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                  placeholder="Lima">
                @if (ciudad?.invalid && ciudad?.touched) {
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">Requerido</p>
                }
              </div>

              <div>
                <label for="codigoPostal" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                  C√≥digo Postal <span class="text-red-500">*</span>
                </label>
                <input type="text" id="codigoPostal" formControlName="codigoPostal"
                  class="w-full px-4 py-3 border border-gray-300 dark:border-dark-border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-dark-bg dark:text-dark-text transition-colors"
                  placeholder="15001">
                @if (codigoPostal?.invalid && codigoPostal?.touched) {
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">Requerido</p>
                }
              </div>
            </div>

            <button type="submit" [disabled]="isAuthenticating"
              class="w-full px-8 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center text-lg">
              @if (isAuthenticating) {
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Creando cuenta...
              } @else {
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
              </svg>
              Crear Cuenta y Continuar
              }
            </button>

            <div class="text-center">
              <p class="text-sm text-gray-600 dark:text-gray-400">
                ¬øYa tienes cuenta? 
                <button type="button" (click)="toggleAuthForm()" class="text-blue-600 dark:text-blue-400 font-semibold hover:underline ml-1">
                  Inicia sesi√≥n aqu√≠
                </button>
              </p>
            </div>
          </form>
        </div>
        }
      </div>
      }

      <!-- Step 1: Course Confirmation -->
      @if (currentStep === 1 && curso) {
      <div class="space-y-6 animate-fadeIn">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-dark-text mb-6">Confirmaci√≥n del Curso</h2>
        
        <div class="border border-gray-200 dark:border-dark-border rounded-lg overflow-hidden">
          <div class="flex flex-col md:flex-row">
            <div class="md:w-1/3">
              <img [src]="curso.imagen" [alt]="curso.titulo" class="w-full h-48 md:h-full object-cover">
            </div>
            <div class="md:w-2/3 p-6">
              <h3 class="text-xl font-bold text-gray-900 dark:text-dark-text mb-2">{{ curso.titulo }}</h3>
              <p class="text-gray-600 dark:text-gray-400 mb-4">{{ curso.descripcion }}</p>
              
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <p class="text-sm text-gray-500 dark:text-gray-400">Duraci√≥n</p>
                  <p class="font-semibold text-gray-900 dark:text-dark-text">{{ curso.duracion }}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-500 dark:text-gray-400">Modalidad</p>
                  <p class="font-semibold text-gray-900 dark:text-dark-text">{{ curso.modalidad }}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-500 dark:text-gray-400">Nivel</p>
                  <p class="font-semibold text-gray-900 dark:text-dark-text">{{ curso.nivel }}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-500 dark:text-gray-400">Instructor</p>
                  <p class="font-semibold text-gray-900 dark:text-dark-text">{{ curso.instructor.nombre }}</p>
                </div>
              </div>

              <div class="pt-4 border-t border-gray-200 dark:border-dark-border">
                <p class="text-sm text-gray-600 dark:text-gray-400">
                  <strong>Certificaci√≥n:</strong> {{ curso.certificacion }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6">
          <h3 class="font-semibold text-gray-900 dark:text-dark-text mb-4 flex items-center">
            <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
            </svg>
            Lo que obtendr√°s
          </h3>
          <ul class="space-y-3 text-sm">
            <li class="flex items-start">
              <svg class="w-5 h-5 text-green-600 dark:text-green-400 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span class="text-gray-700 dark:text-gray-300">Acceso inmediato a todo el contenido del curso</span>
            </li>
            <li class="flex items-start">
              <svg class="w-5 h-5 text-green-600 dark:text-green-400 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span class="text-gray-700 dark:text-gray-300">Certificado digital al completar el curso</span>
            </li>
            <li class="flex items-start">
              <svg class="w-5 h-5 text-green-600 dark:text-green-400 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span class="text-gray-700 dark:text-gray-300">Acceso de por vida al material del curso</span>
            </li>
            <li class="flex items-start">
              <svg class="w-5 h-5 text-green-600 dark:text-green-400 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span class="text-gray-700 dark:text-gray-300">Soporte directo del instructor</span>
            </li>
            <li class="flex items-start">
              <svg class="w-5 h-5 text-green-600 dark:text-green-400 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span class="text-gray-700 dark:text-gray-300">Comunidad exclusiva de estudiantes</span>
            </li>
          </ul>
        </div>
      </div>
      }

      <!-- Step 2: Final Confirmation -->
      @if (currentStep === 2) {
      <div class="text-center space-y-6 animate-fadeIn">
        <div class="w-20 h-20 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto">
          <svg class="w-12 h-12 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <h2 class="text-3xl font-bold text-gray-900 dark:text-dark-text">Confirmaci√≥n Final</h2>
        <p class="text-gray-600 dark:text-gray-400 max-w-md mx-auto">
          @if (isExistingUser) {
          ¬°Perfecto! Est√°s a un paso de acceder al curso. Haz clic en "Confirmar Matr√≠cula" para completar el proceso.
          } @else {
          Todo listo para completar tu matr√≠cula. Haz clic en "Confirmar Matr√≠cula" para finalizar.
          }
        </p>

        @if (curso) {
        <div class="border border-gray-200 dark:border-dark-border rounded-lg p-6 max-w-md mx-auto text-left">
          <div class="flex items-start space-x-4">
            <img [src]="curso.imagen" [alt]="curso.titulo" class="w-24 h-24 rounded-lg object-cover flex-shrink-0">
            <div class="flex-1 min-w-0">
              <h4 class="font-bold text-gray-900 dark:text-dark-text mb-2">{{ curso.titulo }}</h4>
              <div class="space-y-1 text-sm text-gray-600 dark:text-gray-400">
                <p>üìö {{ curso.duracion }}</p>
                <p>üéì {{ curso.modalidad }}</p>
                <p>üë®‚Äçüè´ {{ curso.instructor.nombre }}</p>
              </div>
            </div>
          </div>
        </div>
        }
      </div>
      }

      <!-- Step 3: Success with Credentials -->
      @if (currentStep === 3) {
      <div class="text-center space-y-6 animate-fadeIn">
        <div class="w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto">
          <svg class="w-12 h-12 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
        </div>
        <h2 class="text-3xl font-bold text-gray-900 dark:text-dark-text">¬°Matr√≠cula Exitosa!</h2>
        <p class="text-gray-600 dark:text-gray-400 max-w-md mx-auto">
          {{ successMessage }}
        </p>

        @if (generatedPassword) {
        <div class="bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-300 dark:border-blue-700 rounded-lg p-6 max-w-md mx-auto text-left">
          <div class="flex items-start">
            <svg class="w-6 h-6 text-blue-600 dark:text-blue-400 mr-3 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
            </svg>
            <div class="flex-1">
              <p class="font-bold text-blue-900 dark:text-blue-200 mb-3 text-lg">¬°IMPORTANTE! Guarda estas credenciales</p>
              <div class="space-y-3">
                <div class="bg-white dark:bg-dark-card rounded-md p-3 border border-blue-200 dark:border-blue-800">
                  <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Correo electr√≥nico:</p>
                  <p class="font-mono font-semibold text-blue-700 dark:text-blue-300 break-all">{{ registerForm.value.correoElectronico }}</p>
                </div>
                <div class="bg-white dark:bg-dark-card rounded-md p-3 border border-blue-200 dark:border-blue-800">
                  <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Contrase√±a generada:</p>
                  <p class="font-mono font-bold text-lg text-blue-700 dark:text-blue-300 break-all">{{ generatedPassword }}</p>
                </div>
              </div>
              <p class="text-sm text-blue-800 dark:text-blue-200 mt-4">
                ‚ö†Ô∏è Esta contrase√±a se muestra solo una vez. Gu√°rdala en un lugar seguro.
              </p>
            </div>
          </div>
        </div>
        }

        <div class="flex flex-col sm:flex-row justify-center gap-4 pt-6">
          <a href="/cursos" target="_blank" rel="noopener noreferrer"
            class="px-8 py-3 border border-gray-300 dark:border-dark-border text-base font-semibold rounded-lg text-gray-700 dark:text-dark-text bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-dark-border transition-colors">
            Ver Todos los Cursos
          </a>
          <a href="https://lumina-core-portal.pages.dev/login" target="_blank" rel="noopener noreferrer"
            class="px-8 py-3 border border-transparent text-base font-semibold rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors">
            Iniciar Sesi√≥n en el Portal
          </a>
        </div>
      </div>
      }
    </div>

    <!-- Navigation Buttons -->
    @if (currentStep > 0 && currentStep < 3) {
    <div class="flex justify-between items-center">
      <button (click)="cancelEnrollment()" type="button"
        class="px-6 py-3 border border-gray-300 dark:border-dark-border text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-dark-border transition-colors duration-200">
        Cancelar
      </button>

      <div class="flex space-x-4">
        @if (currentStep > 1) {
        <button (click)="previousStep()" type="button"
          class="px-6 py-3 border border-gray-300 dark:border-dark-border text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-dark-border transition-colors duration-200">
          Anterior
        </button>
        }

        @if (currentStep === 1) {
        <button (click)="nextStep()" type="button"
          class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 font-semibold">
          Continuar
        </button>
        }

        @if (currentStep === 2) {
        <button (click)="completeEnrollment()" type="button" [disabled]="loading"
          class="px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
          @if (loading) {
          <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Procesando...
          } @else {
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Confirmar Matr√≠cula
          }
        </button>
        }
      </div>
    </div>
    }

    @if (currentStep === 0) {
    <div class="text-center">
      <button (click)="cancelEnrollment()" type="button"
        class="px-6 py-3 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors duration-200">
        ‚Üê Volver a los cursos
      </button>
    </div>
    }
  </div>
</div>
